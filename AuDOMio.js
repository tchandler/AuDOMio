function AudioFileRequest(t,e){this.url=t,("undefined"==typeof e||null==e)&&(e=!0),this.async=e;var i=t.split(".");this.extension=i[i.length-1].toLowerCase()}function Decoder(){}function WAVDecoder(){}function AIFFDecoder(){}function AudioletDevice(t,e,i,n){AudioletNode.call(this,t,1,0),this.sink=Sink(this.tick.bind(this),i,n,e),this.sampleRate=this.sink.sampleRate,this.numberOfChannels=this.sink.channelCount,this.bufferSize=this.sink.preBufferSize,this.writePosition=0,this.buffer=null,this.paused=!1,this.needTraverse=!0,this.nodes=[]}function extend(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}function Note(t){this.coord=t}function Interval(t){this.coord=t}function add_addsubtract_func(t){return t.add=function(t){var e,i=[];for(e in this)"object"==typeof this[e]&&(i[e]=this[e].add(t));return add_addsubtract_func(i),i},t.subtract=function(t){var e,i=[];for(e in this)"object"==typeof this[e]&&(i[e]=this[e].subtract(t));return add_addsubtract_func(i),i},t}AudioFileRequest.prototype.onSuccess=function(){},AudioFileRequest.prototype.onFailure=function(){},AudioFileRequest.prototype.send=function(){if("wav"!=this.extension&&"aiff"!=this.extension&&"aif"!=this.extension)return void this.onFailure();var t=new XMLHttpRequest;t.open("GET",this.url,this.async),t.overrideMimeType("text/plain; charset=x-user-defined"),t.onreadystatechange=function(){4==t.readyState&&(200==t.status||0==t.status?this.handleResponse(t.responseText):this.onFailure())}.bind(this),t.send(null)},AudioFileRequest.prototype.handleResponse=function(t){var e,i;"wav"==this.extension?(e=new WAVDecoder,i=e.decode(t)):("aiff"==this.extension||"aif"==this.extension)&&(e=new AIFFDecoder,i=e.decode(t)),this.onSuccess(i)},Decoder.prototype.readString=function(t,e,i){return t.slice(e,e+i)},Decoder.prototype.readIntL=function(t,e,i){for(var n=0,s=0;i>s;s++)n+=(255&t.charCodeAt(e+s))*Math.pow(2,8*s);return n},Decoder.prototype.readChunkHeaderL=function(t,e){var i={};return i.name=this.readString(t,e,4),i.length=this.readIntL(t,e+4,4),i},Decoder.prototype.readIntB=function(t,e,i){for(var n=0,s=0;i>s;s++)n+=(255&t.charCodeAt(e+s))*Math.pow(2,8*(i-s-1));return n},Decoder.prototype.readChunkHeaderB=function(t,e){var i={};return i.name=this.readString(t,e,4),i.length=this.readIntB(t,e+4,4),i},Decoder.prototype.readFloatB=function(t,e){var i=this.readIntB(t,e,2),n=32768;i>=n&&(i|=~(n-1));var s=1;0>i&&(s=-1,i+=n);var r,o=this.readIntB(t,e+2,4),a=this.readIntB(t,e+6,4);return i==o==a==0?r=0:32767==i?r=Number.MAX_VALUE:(i-=16383,r=(4294967296*o+a)*Math.pow(2,i-63)),s*r},WAVDecoder.prototype.__proto__=Decoder.prototype,WAVDecoder.prototype.decode=function(t){var e={},i=0,n=this.readChunkHeaderL(t,i);if(i+=8,"RIFF"!=n.name)return console.error("File is not a WAV"),null;var s=n.length;s+=8;var r=this.readString(t,i,4);if(i+=4,"WAVE"!=r)return console.error("File is not a WAV"),null;for(;s>i;){var n=this.readChunkHeaderL(t,i);if(i+=8,"fmt "==n.name){var o=this.readIntL(t,i,2);if(i+=2,1!=o)return console.error("Cannot decode non-PCM encoded WAV file"),null;var a=this.readIntL(t,i,2);i+=2;var h=this.readIntL(t,i,4);i+=4,i+=4,i+=2;var u=this.readIntL(t,i,2),l=u/8;i+=2}else if("data"==n.name){for(var f=n.length/(l*a),c=[],p=0;a>p;p++)c.push(new Float32Array(f));for(var p=0;a>p;p++)for(var d=c[p],m=0;f>m;m++){var v=i;v+=(m*a+p)*l;var g=this.readIntL(t,v,l),y=1<<u-1;g>=y&&(g|=~(y-1)),d[m]=g/y}i+=n.length}else i+=n.length}return e.sampleRate=h,e.bitDepth=u,e.channels=c,e.length=f,e},AIFFDecoder.prototype.__proto__=Decoder.prototype,AIFFDecoder.prototype.decode=function(t){var e={},i=0,n=this.readChunkHeaderB(t,i);if(i+=8,"FORM"!=n.name)return console.error("File is not an AIFF"),null;var s=n.length;s+=8;var r=this.readString(t,i,4);if(i+=4,"AIFF"!=r)return console.error("File is not an AIFF"),null;for(;s>i;){var n=this.readChunkHeaderB(t,i);if(i+=8,"COMM"==n.name){var o=this.readIntB(t,i,2);i+=2;var a=this.readIntB(t,i,4);i+=4;for(var h=[],u=0;o>u;u++)h.push(new Float32Array(a));var l=this.readIntB(t,i,2),f=l/8;i+=2;var c=this.readFloatB(t,i);i+=10}else if("SSND"==n.name){var p=this.readIntB(t,i,4);i+=4,i+=4,i+=p;for(var u=0;o>u;u++)for(var d=h[u],m=0;a>m;m++){var v=i;v+=(m*o+u)*f;var g=this.readIntB(t,v,f),y=1<<l-1;g>=y&&(g|=~(y-1)),d[m]=g/y}i+=n.length-p-8}else i+=n.length}return e.sampleRate=c,e.bitDepth=l,e.channels=h,e.length=a,e};var AudioletBuffer=function(t,e){this.numberOfChannels=t,this.length=e,this.channels=[];for(var i=0;i<this.numberOfChannels;i++)this.channels.push(new Float32Array(e));this.unslicedChannels=[];for(var i=0;i<this.numberOfChannels;i++)this.unslicedChannels.push(this.channels[i]);this.isEmpty=!1,this.channelOffset=0};AudioletBuffer.prototype.getChannelData=function(t){return this.channels[t]},AudioletBuffer.prototype.set=function(t){for(var e=t.numberOfChannels,i=0;e>i;i++)this.channels[i].set(t.getChannelData(i))},AudioletBuffer.prototype.setSection=function(t,e,i,n){i=i||0,n=n||0;for(var s=t.numberOfChannels,r=0;s>r;r++){i+=t.channelOffset,n+=this.channelOffset;var o=this.unslicedChannels[r].subarray(n,n+e),a=t.unslicedChannels[r].subarray(i,i+e);o.set(a)}},AudioletBuffer.prototype.add=function(t){for(var e=this.length,i=t.numberOfChannels,n=0;i>n;n++)for(var s=this.getChannelData(n),r=t.getChannelData(n),o=0;e>o;o++)s[o]+=r[o]},AudioletBuffer.prototype.addSection=function(t,e,i,n){i=i||0,n=n||0;for(var s=t.numberOfChannels,r=0;s>r;r++)for(var o=this.getChannelData(r),a=t.getChannelData(r),h=0;e>h;h++)o[h+n]+=a[h+i]},AudioletBuffer.prototype.resize=function(t,e,i,n){n=n||0;for(var s=this.channels,r=this.unslicedChannels,o=this.length,a=this.channelOffset+n,h=0;t>h;h++){var u=s[h],l=r[h];if(e>o){var f=u;(!i||!l||l.length<e)&&(l=new Float32Array(e)),u=l.subarray(0,e),!i&&f&&u.set(f,n),a=0}else{if(!l){var c=r[0].length;l=new Float32Array(c)}n=a,u=l.subarray(n,n+e)}s[h]=u,r[h]=l}this.channels=s.slice(0,t),this.unslicedChannels=r.slice(0,t),this.length=e,this.numberOfChannels=t,this.channelOffset=a},AudioletBuffer.prototype.push=function(t){var e=t.length;this.resize(this.numberOfChannels,this.length+e),this.setSection(t,e,0,this.length-e)},AudioletBuffer.prototype.pop=function(t){var e=t.length,i=this.length-e;t.setSection(this,e,i,0),this.resize(this.numberOfChannels,i)},AudioletBuffer.prototype.unshift=function(t){var e=t.length;this.resize(this.numberOfChannels,this.length+e,!1,e),this.setSection(t,e,0,0)},AudioletBuffer.prototype.shift=function(t){var e=t.length;t.setSection(this,e,0,0),this.resize(this.numberOfChannels,this.length-e,!1,e)},AudioletBuffer.prototype.zero=function(){for(var t=this.numberOfChannels,e=0;t>e;e++)for(var i=this.getChannelData(e),n=this.length,s=0;n>s;s++)i[s]=0},AudioletBuffer.prototype.combined=function(){for(var t=this.channels,e=this.numberOfChannels,i=this.length,n=new Float32Array(e*i),s=0;e>s;s++)n.set(t[s],s*i);return n},AudioletBuffer.prototype.interleaved=function(){for(var t=this.channels,e=this.numberOfChannels,i=this.length,n=new Float32Array(e*i),s=0;i>s;s++)for(var r=0;e>r;r++)n[e*s+r]=t[r][s];return n},AudioletBuffer.prototype.copy=function(){var t=new AudioletBuffer(this.numberOfChannels,this.length);return t.set(this),t},AudioletBuffer.prototype.load=function(t,e,i){var n=new AudioFileRequest(t,e);n.onSuccess=function(t){this.length=t.length,this.numberOfChannels=t.channels.length,this.unslicedChannels=t.channels,this.channels=t.channels,this.channelOffset=0,i&&i()}.bind(this),n.onFailure=function(){console.error("Could not load",t)}.bind(this),n.send()};var AudioletGroup=function(t,e,i){this.audiolet=t,this.inputs=[];for(var n=0;e>n;n++)this.inputs.push(new PassThroughNode(this.audiolet,1,1));this.outputs=[];for(var n=0;i>n;n++)this.outputs.push(new PassThroughNode(this.audiolet,1,1))};AudioletGroup.prototype.connect=function(t,e,i){this.outputs[e||0].connect(t,0,i)},AudioletGroup.prototype.disconnect=function(t,e,i){this.outputs[e||0].disconnect(t,0,i)},AudioletGroup.prototype.remove=function(){for(var t=this.inputs.length,e=0;t>e;e++)this.inputs[e].remove();for(var i=this.outputs.length,e=0;i>e;e++)this.outputs[e].remove()};var AudioletDestination=function(t,e,i,n){AudioletGroup.call(this,t,1,0),this.device=new AudioletDevice(t,e,i,n),t.device=this.device,this.scheduler=new Scheduler(t),t.scheduler=this.scheduler,this.upMixer=new UpMixer(t,this.device.numberOfChannels),this.inputs[0].connect(this.scheduler),this.scheduler.connect(this.upMixer),this.upMixer.connect(this.device)};extend(AudioletDestination,AudioletGroup),AudioletDestination.prototype.toString=function(){return"Destination"};var AudioletNode=function(t,e,i,n){this.audiolet=t,this.inputs=[];for(var s=0;e>s;s++)this.inputs.push(new AudioletInput(this,s));this.outputs=[];for(var s=0;i>s;s++)this.outputs.push(new AudioletOutput(this,s));n&&(this.generate=n)};AudioletNode.prototype.connect=function(t,e,i){t instanceof AudioletGroup&&(t=t.inputs[i||0],i=0);var n=this.outputs[e||0],s=t.inputs[i||0];n.connect(s),s.connect(n),this.audiolet.device.needTraverse=!0},AudioletNode.prototype.disconnect=function(t,e,i){t instanceof AudioletGroup&&(t=t.inputs[i||0],i=0);var n=this.outputs[e||0],s=t.inputs[i||0];s.disconnect(n),n.disconnect(s),this.audiolet.device.needTraverse=!0},AudioletNode.prototype.setNumberOfOutputChannels=function(t,e){this.outputs[t].numberOfChannels=e},AudioletNode.prototype.linkNumberOfOutputChannels=function(t,e){this.outputs[t].linkNumberOfChannels(this.inputs[e])},AudioletNode.prototype.tick=function(){this.createInputSamples(),this.createOutputSamples(),this.generate()},AudioletNode.prototype.traverse=function(t){return-1==t.indexOf(this)&&(t.push(this),t=this.traverseParents(t)),t},AudioletNode.prototype.traverseParents=function(t){for(var e=this.inputs.length,i=0;e>i;i++)for(var n=this.inputs[i],s=n.connectedFrom.length,r=0;s>r;r++)t=n.connectedFrom[r].node.traverse(t);return t},AudioletNode.prototype.generate=function(){},AudioletNode.prototype.createInputSamples=function(){for(var t=this.inputs.length,e=0;t>e;e++){for(var i=this.inputs[e],n=0,s=0;s<i.connectedFrom.length;s++)for(var r=i.connectedFrom[s],o=0;o<r.samples.length;o++){var a=r.samples[o];n>o?i.samples[o]+=a:(i.samples[o]=a,n+=1)}i.samples.length>n&&(i.samples=i.samples.slice(0,n))}},AudioletNode.prototype.createOutputSamples=function(){for(var t=this.outputs.length,e=0;t>e;e++){var i=this.outputs[e],n=i.getNumberOfChannels();if(i.samples.length!=n)if(i.samples.length>n)i.samples=i.samples.slice(0,n);else for(var s=i.samples.length;n>s;s++)i.samples[s]=0}},AudioletNode.prototype.remove=function(){for(var t=this.inputs.length,e=0;t>e;e++)for(var i=this.inputs[e],n=i.connectedFrom.length,s=0;n>s;s++){var r=i.connectedFrom[s],o=r.node;o.disconnect(this,r.index,e)}for(var a=this.outputs.length,e=0;a>e;e++)for(var o=this.outputs[e],n=o.connectedTo.length,s=0;n>s;s++){var h=o.connectedTo[s],i=h.node;this.disconnect(i,e,h.index)}},extend(AudioletDevice,AudioletNode),AudioletDevice.prototype.tick=function(t,e){if(!this.paused)for(var i=this.inputs[0],n=t.length/e,s=0;n>s;s++){this.needTraverse&&(this.nodes=this.traverse([]),this.needTraverse=!1);for(var r=this.nodes.length-1;r>0;r--)this.nodes[r].tick();this.createInputSamples();for(var r=0;e>r;r++)t[s*e+r]=i.samples[r];this.writePosition+=1}},AudioletDevice.prototype.getPlaybackTime=function(){return this.sink.getPlaybackTime()},AudioletDevice.prototype.getWriteTime=function(){return this.writePosition},AudioletDevice.prototype.pause=function(){this.paused=!0},AudioletDevice.prototype.play=function(){this.paused=!1},AudioletDevice.prototype.toString=function(){return"Audio Output Device"};var AudioletInput=function(t,e){this.node=t,this.index=e,this.connectedFrom=[],this.samples=[]};AudioletInput.prototype.connect=function(t){this.connectedFrom.push(t)},AudioletInput.prototype.disconnect=function(t){for(var e=this.connectedFrom.length,i=0;e>i;i++)if(t==this.connectedFrom[i]){this.connectedFrom.splice(i,1);break}0==this.connectedFrom.length&&(this.samples=[])},AudioletInput.prototype.toString=function(){return this.node.toString()+"Input #"+this.index};var Audiolet=function(t,e,i){this.output=new AudioletDestination(this,t,e,i)},AudioletOutput=function(t,e){this.node=t,this.index=e,this.connectedTo=[],this.samples=[],this.linkedInput=null,this.numberOfChannels=1};AudioletOutput.prototype.connect=function(t){this.connectedTo.push(t)},AudioletOutput.prototype.disconnect=function(t){for(var e=this.connectedTo.length,i=0;e>i;i++)if(t==this.connectedTo[i]){this.connectedTo.splice(i,1);break}},AudioletOutput.prototype.linkNumberOfChannels=function(t){this.linkedInput=t},AudioletOutput.prototype.unlinkNumberOfChannels=function(){this.linkedInput=null},AudioletOutput.prototype.getNumberOfChannels=function(){return this.linkedInput&&this.linkedInput.connectedFrom.length?this.linkedInput.samples.length:this.numberOfChannels},AudioletOutput.prototype.toString=function(){return this.node.toString()+"Output #"+this.index+" - "};var AudioletParameter=function(t,e,i){this.node=t,this.input="undefined"!=typeof e&&null!=e?t.inputs[e]:null,this.value=i||0};AudioletParameter.prototype.isStatic=function(){return 0==this.input.samples.length},AudioletParameter.prototype.isDynamic=function(){return this.input.samples.length>0},AudioletParameter.prototype.setValue=function(t){this.value=t},AudioletParameter.prototype.getValue=function(){return null!=this.input&&this.input.samples.length>0?this.input.samples[0]:this.value};var ParameterNode=function(t,e){AudioletNode.call(this,t,1,1),this.parameter=new AudioletParameter(this,0,e)};extend(ParameterNode,AudioletNode),ParameterNode.prototype.generate=function(){this.outputs[0].samples[0]=this.parameter.getValue()},ParameterNode.prototype.toString=function(){return"Parameter Node"};var PassThroughNode=function(t,e,i){AudioletNode.call(this,t,e,i)};extend(PassThroughNode,AudioletNode),PassThroughNode.prototype.createOutputSamples=function(){for(var t=this.outputs.length,e=0;t>e;e++){var i=this.inputs[e],n=this.outputs[e];if(i&&0!=i.samples.length)n.samples=i.samples;else{var s=n.getNumberOfChannels();if(n.samples.length==s)continue;if(n.samples.length>s){n.samples=n.samples.slice(0,s);continue}for(var r=n.samples.length;s>r;r++)n.samples[r]=0}}},PassThroughNode.prototype.toString=function(){return"Pass Through Node"};var PriorityQueue=function(t,e){if(e&&(this.compare=e),t){this.heap=t;for(var i=0;i<Math.floor(this.heap.length/2);i++)this.siftUp(i)}else this.heap=[]};PriorityQueue.prototype.push=function(t){this.heap.push(t),this.siftDown(0,this.heap.length-1)},PriorityQueue.prototype.pop=function(){var t,e;if(t=this.heap.pop(),this.heap.length){var e=this.heap[0];this.heap[0]=t,this.siftUp(0)}else e=t;return e},PriorityQueue.prototype.peek=function(){return this.heap[0]},PriorityQueue.prototype.isEmpty=function(){return 0==this.heap.length},PriorityQueue.prototype.siftDown=function(t,e){for(var i=this.heap[e];e>t;){var n=e-1>>1,s=this.heap[n];if(!this.compare(i,s))break;this.heap[e]=s,e=n}this.heap[e]=i},PriorityQueue.prototype.siftUp=function(t){for(var e=this.heap.length,i=t,n=this.heap[t],s=2*t+1;e>s;){var r=s+1;e>r&&!this.compare(this.heap[s],this.heap[r])&&(s=r),this.heap[t]=this.heap[s],t=s,s=2*t+1}this.heap[t]=n,this.siftDown(i,t)},PriorityQueue.prototype.compare=function(t,e){return e>t};var Scheduler=function(t,e){PassThroughNode.call(this,t,1,1),this.linkNumberOfOutputChannels(0,0),this.bpm=e||120,this.queue=new PriorityQueue(null,function(t,e){return t.time<e.time}),this.time=0,this.beat=0,this.beatInBar=0,this.bar=0,this.seconds=0,this.beatsPerBar=0,this.lastBeatTime=0,this.beatLength=60/this.bpm*this.audiolet.device.sampleRate};extend(Scheduler,PassThroughNode),Scheduler.prototype.setTempo=function(t){this.bpm=t,this.beatLength=60/this.bpm*this.audiolet.device.sampleRate},Scheduler.prototype.addRelative=function(t,e){var i={};return i.callback=e,i.time=this.time+t*this.beatLength,this.queue.push(i),i},Scheduler.prototype.addAbsolute=function(t,e){if(t<this.beat||t==this.beat&&this.time>this.lastBeatTime)return null;var i={};return i.callback=e,i.time=this.lastBeatTime+(t-this.beat)*this.beatLength,this.queue.push(i),i},Scheduler.prototype.play=function(t,e,i){var n={};return n.patterns=t,n.durationPattern=e,n.callback=i,n.time=this.audiolet.device.getWriteTime(),this.queue.push(n),n},Scheduler.prototype.playAbsolute=function(t,e,i,n){if(t<this.beat||t==this.beat&&this.time>this.lastBeatTime)return null;var s={};return s.patterns=e,s.durationPattern=i,s.callback=n,s.time=this.lastBeatTime+(t-this.beat)*this.beatLength,this.queue.push(s),s},Scheduler.prototype.remove=function(t){var e=this.queue.heap.indexOf(t);-1!=e&&(this.queue.heap.splice(e,1),this.queue=new PriorityQueue(this.queue.heap,function(t,e){return t.time<e.time}))},Scheduler.prototype.stop=function(t){this.remove(t)},Scheduler.prototype.tick=function(){for(PassThroughNode.prototype.tick.call(this),this.tickClock();!this.queue.isEmpty()&&this.queue.peek().time<=this.time;){var t=this.queue.pop();this.processEvent(t)}},Scheduler.prototype.tickClock=function(){this.time+=1,this.seconds=this.time/this.audiolet.device.sampleRate,this.time>=this.lastBeatTime+this.beatLength&&(this.beat+=1,this.beatInBar+=1,this.beatInBar==this.beatsPerBar&&(this.bar+=1,this.beatInBar=0),this.lastBeatTime+=this.beatLength)},Scheduler.prototype.processEvent=function(t){var e=t.durationPattern;if(e){for(var i=[],n=t.patterns,s=n.length,r=0;s>r;r++){var o=n[r],a=o.next();if(null==a)return;i.push(a)}t.callback.apply(null,i);var h;h=e instanceof Pattern?e.next():e,h&&(t.time+=h*this.beatLength,this.queue.push(t))}else t.callback()},Scheduler.prototype.toString=function(){return"Scheduler"};for(var Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,types=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],original,shim,i=0;i<types.length;++i)types[i]&&(void 0===types[i].prototype.slice?(original="subarray",shim="slice"):void 0===types[i].prototype.subarray&&(original="slice",shim="subarray"),Object.defineProperty(types[i].prototype,shim,{value:types[i].prototype[original],enumerable:!1}));var Envelope=function(t,e,i,n,s,r){AudioletNode.call(this,t,1,1),this.gate=new AudioletParameter(this,0,e||1),this.levels=[];for(var o=0;o<i.length;o++)this.levels.push(new AudioletParameter(this,null,i[o]));this.times=[];for(var o=0;o<n.length;o++)this.times.push(new AudioletParameter(this,null,n[o]));this.releaseStage=s,this.onComplete=r,this.stage=null,this.time=null,this.changeTime=null,this.level=this.levels[0].getValue(),this.delta=0,this.gateOn=!1};extend(Envelope,AudioletNode),Envelope.prototype.generate=function(){var t=this.gate.getValue(),e=!1;t&&!this.gateOn&&(this.gateOn=!0,this.stage=0,this.time=0,this.delta=0,this.level=this.levels[0].getValue(),this.stage!=this.releaseStage&&(e=!0)),this.gateOn&&!t&&(this.gateOn=!1,null!=this.releaseStage&&(this.stage=this.releaseStage,e=!0)),this.changeTime&&(this.time+=1,this.time>=this.changeTime&&(this.stage+=1,this.stage!=this.releaseStage?e=!0:(this.changeTime=null,this.delta=0))),e&&(this.stage!=this.times.length?(this.delta=this.calculateDelta(this.stage,this.level),this.changeTime=this.calculateChangeTime(this.stage,this.time)):(this.onComplete&&this.onComplete(),this.stage=null,this.time=null,this.changeTime=null,this.delta=0)),this.level+=this.delta,this.outputs[0].samples[0]=this.level},Envelope.prototype.calculateDelta=function(t,e){var i=this.levels[t+1].getValue()-e,n=this.times[t].getValue()*this.audiolet.device.sampleRate;return i/n},Envelope.prototype.calculateChangeTime=function(t,e){var i=this.times[t].getValue()*this.audiolet.device.sampleRate;return e+i},Envelope.prototype.toString=function(){return"Envelope"};var ADSREnvelope=function(t,e,i,n,s,r,o){var a=[0,1,s,0],h=[i,n,r];Envelope.call(this,t,e,a,h,2,o),this.attack=this.times[0],this.decay=this.times[1],this.sustain=this.levels[2],this.release=this.levels[2]};extend(ADSREnvelope,Envelope),ADSREnvelope.prototype.toString=function(){return"ADSR Envelope"};var BiquadFilter=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.frequency=new AudioletParameter(this,1,e||22100),this.lastFrequency=null,this.xValues=[],this.yValues=[],this.b0=0,this.b1=0,this.b2=0,this.a0=0,this.a1=0,this.a2=0};extend(BiquadFilter,AudioletNode),BiquadFilter.prototype.calculateCoefficients=function(){},BiquadFilter.prototype.generate=function(){var t=this.inputs[0],e=this.outputs[0],i=this.xValues,n=this.yValues,s=this.frequency.getValue();s!=this.lastFrequency&&(this.calculateCoefficients(s),this.lastFrequency=s);for(var r=this.a0,o=this.a1,a=this.a2,h=this.b0,u=this.b1,l=this.b2,f=t.samples.length,c=0;f>c;c++){c>=i.length&&(i.push([0,0]),n.push([0,0]));var p=i[c],d=p[0],m=p[1],v=n[c],g=v[0],y=v[1],b=t.samples[c],A=h/r*b+u/r*d+l/r*m-o/r*g-a/r*y;e.samples[c]=A,p[0]=b,p[1]=d,v[0]=A,v[1]=g}},BiquadFilter.prototype.toString=function(){return"Biquad Filter"};var AllPassFilter=function(t,e){BiquadFilter.call(this,t,e)};extend(AllPassFilter,BiquadFilter),AllPassFilter.prototype.calculateCoefficients=function(t){var e=2*Math.PI*t/this.audiolet.device.sampleRate,i=Math.cos(e),n=Math.sin(e),s=n/(2/Math.sqrt(2));this.b0=1-s,this.b1=-2*i,this.b2=1+s,this.a0=1+s,this.a1=-2*i,this.a2=1-s},AllPassFilter.prototype.toString=function(){return"All Pass Filter"};var Amplitude=function(t,e,i){AudioletNode.call(this,t,3,1),this.linkNumberOfOutputChannels(0,0),this.followers=[],this.attack=new AudioletParameter(this,1,e||.01),this.release=new AudioletParameter(this,2,i||.01)};extend(Amplitude,AudioletNode),Amplitude.prototype.generate=function(){var t=this.inputs[0],e=this.outputs[0],i=this.followers,n=i.length,s=this.audiolet.device.sampleRate,r=this.attack.getValue();r=Math.pow(.01,1/(r*s));var o=this.release.getValue();o=Math.pow(.01,1/(o*s));for(var a=t.samples.length,h=0;a>h;h++){h>=n&&i.push(0);var u=i[h],l=Math.abs(t.samples[h]);u=l>u?r*(u-l)+l:o*(u-l)+l,e.samples[h]=u,i[h]=u}},Amplitude.prototype.toString=function(){return"Amplitude"};var BadValueDetector=function(t,e){PassThroughNode.call(this,t,1,1),this.linkNumberOfOutputChannels(0,0),e&&(this.callback=e)};extend(BadValueDetector,PassThroughNode),BadValueDetector.prototype.callback=function(t,e){console.error(t+" detected at channel "+e)},BadValueDetector.prototype.generate=function(){for(var t=this.inputs[0],e=t.samples.length,i=0;e>i;i++){var n=t.samples[i];("undefined"==typeof n||null==n||isNaN(n)||1/0==n||n==-1/0)&&this.callback(n,i)}},BadValueDetector.prototype.toString=function(){return"Bad Value Detector"};var BandPassFilter=function(t,e){BiquadFilter.call(this,t,e)};extend(BandPassFilter,BiquadFilter),BandPassFilter.prototype.calculateCoefficients=function(t){var e=2*Math.PI*t/this.audiolet.device.sampleRate,i=Math.cos(e),n=Math.sin(e),s=n/(2/Math.sqrt(2));this.b0=s,this.b1=0,this.b2=-s,this.a0=1+s,this.a1=-2*i,this.a2=1-s},BandPassFilter.prototype.toString=function(){return"Band Pass Filter"};var BandRejectFilter=function(t,e){BiquadFilter.call(this,t,e)};extend(BandRejectFilter,BiquadFilter),BandRejectFilter.prototype.calculateCoefficients=function(t){var e=2*Math.PI*t/this.audiolet.device.sampleRate,i=Math.cos(e),n=Math.sin(e),s=n/(2/Math.sqrt(2));this.b0=1,this.b1=-2*i,this.b2=1,this.a0=1+s,this.a1=-2*i,this.a2=1-s},BandRejectFilter.prototype.toString=function(){return"Band Reject Filter"};var BitCrusher=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.bits=new AudioletParameter(this,1,e)};extend(BitCrusher,AudioletNode),BitCrusher.prototype.generate=function(){for(var t=this.inputs[0],e=Math.pow(2,this.bits.getValue())-1,i=t.samples.length,n=0;i>n;n++)this.outputs[0].samples[n]=Math.floor(t.samples[n]*e)/e},BitCrusher.prototype.toString=function(){return"BitCrusher"};var BufferPlayer=function(t,e,i,n,s,r){AudioletNode.call(this,t,3,1),this.buffer=e,this.setNumberOfOutputChannels(0,this.buffer.numberOfChannels),this.position=n||0,this.playbackRate=new AudioletParameter(this,0,i||1),this.restartTrigger=new AudioletParameter(this,1,0),this.startPosition=new AudioletParameter(this,2,n||0),this.loop=new AudioletParameter(this,3,s||0),this.onComplete=r,this.restartTriggerOn=!1,this.playing=!0};extend(BufferPlayer,AudioletNode),BufferPlayer.prototype.generate=function(){var t=this.outputs[0],e=t.samples.length;if(0!=this.buffer.length&&this.playing){var i=this.playbackRate.getValue(),n=this.restartTrigger.getValue(),s=this.startPosition.getValue(),r=this.loop.getValue();n>0&&!this.restartTriggerOn&&(this.position=s,this.restartTriggerOn=!0,this.playing=!0),0>=n&&this.restartTriggerOn&&(this.restartTriggerOn=!1);for(var e=this.buffer.channels.length,o=0;e>o;o++){var a=this.buffer.getChannelData(o);t.samples[o]=a[Math.floor(this.position)]}this.position+=i,this.position>=this.buffer.length&&(r?this.position%=this.buffer.length:(this.playing=!1,this.onComplete&&this.onComplete()))}else for(var o=0;e>o;o++)t.samples[o]=0},BufferPlayer.prototype.toString=function(){return"Buffer player"};var CombFilter=function(t,e,i,n){AudioletNode.call(this,t,3,1),this.linkNumberOfOutputChannels(0,0),this.maximumDelayTime=e,this.delayTime=new AudioletParameter(this,1,i||1),this.decayTime=new AudioletParameter(this,2,n),this.buffers=[],this.readWriteIndex=0};extend(CombFilter,AudioletNode),CombFilter.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.audiolet.device.sampleRate,n=this.delayTime.getValue()*i,s=this.decayTime.getValue()*i,r=Math.exp(-3*n/s),o=t.samples.length,a=0;o>a;a++){if(a>=this.buffers.length){var h=this.maximumDelayTime*i;this.buffers.push(new Float32Array(h))}var u=this.buffers[a],l=u[this.readWriteIndex];e.samples[a]=l,u[this.readWriteIndex]=t.samples[a]+r*l}this.readWriteIndex+=1,this.readWriteIndex>=n&&(this.readWriteIndex=0)},CombFilter.prototype.toString=function(){return"Comb Filter"};var Sine=function(t,e){AudioletNode.call(this,t,1,1),this.frequency=new AudioletParameter(this,0,e||440),this.phase=0};extend(Sine,AudioletNode),Sine.prototype.generate=function(){var t=this.outputs[0],e=this.frequency.getValue(),i=this.audiolet.device.sampleRate;t.samples[0]=Math.sin(this.phase),this.phase+=2*Math.PI*e/i,this.phase>2*Math.PI&&(this.phase%=2*Math.PI)},Sine.prototype.toString=function(){return"Sine"};var CrossFade=function(t,e){AudioletNode.call(this,t,3,1),this.linkNumberOfOutputChannels(0,0),this.position=new AudioletParameter(this,2,e||.5)};extend(CrossFade,AudioletNode),CrossFade.prototype.generate=function(){for(var t=this.inputs[0],e=this.inputs[1],i=this.outputs[0],n=this.position.getValue(),s=n*Math.PI/2,r=Math.cos(s),o=Math.sin(s),a=i.samples.length,h=0;a>h;h++){var u=t.samples[h]||0,l=e.samples[h]||0;i.samples[h]=u*r+l*o}},CrossFade.prototype.toString=function(){return"Cross Fader"};var DampedCombFilter=function(t,e,i,n,s){AudioletNode.call(this,t,4,1),this.linkNumberOfOutputChannels(0,0),this.maximumDelayTime=e,this.delayTime=new AudioletParameter(this,1,i||1),this.decayTime=new AudioletParameter(this,2,n),this.damping=new AudioletParameter(this,3,s);e*this.audiolet.device.sampleRate;this.buffers=[],this.readWriteIndex=0,this.filterStores=[]};extend(DampedCombFilter,AudioletNode),DampedCombFilter.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.audiolet.device.sampleRate,n=this.delayTime.getValue()*i,s=this.decayTime.getValue()*i,r=this.damping.getValue(),o=Math.exp(-3*n/s),a=t.samples.length,h=0;a>h;h++){if(h>=this.buffers.length){var u=this.maximumDelayTime*i;this.buffers.push(new Float32Array(u))}h>=this.filterStores.length&&this.filterStores.push(0);var l=this.buffers[h],f=this.filterStores[h],c=l[this.readWriteIndex];f=c*(1-r)+f*r,e.samples[h]=c,l[this.readWriteIndex]=t.samples[h]+o*f,this.filterStores[h]=f}this.readWriteIndex+=1,this.readWriteIndex>=n&&(this.readWriteIndex=0)},DampedCombFilter.prototype.toString=function(){return"Damped Comb Filter"};var DCFilter=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.coefficient=new AudioletParameter(this,1,e||.995),this.xValues=[],this.yValues=[]};extend(DCFilter,AudioletNode),DCFilter.prototype.generate=function(){for(var t=this.coefficient.getValue(),e=this.inputs[0],i=e.samples.length,n=0;i>n;n++){n>=this.xValues.length&&this.xValues.push(0),n>=this.yValues.length&&this.yValues.push(0);var s=e.samples[n],r=s-this.xValues[n]+t*this.yValues[n];this.outputs[0].samples[n]=r,this.xValues[n]=s,this.yValues[n]=r}},DCFilter.prototype.toString=function(){return"DC Filter"};var Delay=function(t,e,i){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.maximumDelayTime=e,this.delayTime=new AudioletParameter(this,1,i||1);e*this.audiolet.device.sampleRate;this.buffers=[],this.readWriteIndex=0};extend(Delay,AudioletNode),Delay.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.audiolet.device.sampleRate,n=this.delayTime.getValue()*i,s=t.samples.length,r=0;s>r;r++){if(r>=this.buffers.length){var o=this.maximumDelayTime*i;this.buffers.push(new Float32Array(o))}var a=this.buffers[r];e.samples[r]=a[this.readWriteIndex],a[this.readWriteIndex]=t.samples[r]}this.readWriteIndex+=1,this.readWriteIndex>=n&&(this.readWriteIndex=0)},Delay.prototype.toString=function(){return"Delay"};var DiscontinuityDetector=function(t,e,i){AudioletNode.call(this,t,1,1),this.linkNumberOfOutputChannels(0,0),this.threshold=e||.2,i&&(this.callback=i),this.lastValues=[]};extend(DiscontinuityDetector,AudioletNode),DiscontinuityDetector.prototype.callback=function(t,e){console.error("Discontinuity of "+t+" detected on channel "+e)},DiscontinuityDetector.prototype.generate=function(){for(var t=this.inputs[0],e=(this.outputs[0],t.samples.length),i=0;e>i;i++){i>=this.lastValues.length&&this.lastValues.push(0);var n=t.samples[i],s=Math.abs(this.lastValues[i]-n);s>this.threshold&&this.callback(s,i),this.lastValues[i]=n}},DiscontinuityDetector.prototype.toString=function(){return"Discontinuity Detector"};var FeedbackDelay=function(t,e,i,n,s){AudioletNode.call(this,t,4,1),this.linkNumberOfOutputChannels(0,0),this.maximumDelayTime=e,this.delayTime=new AudioletParameter(this,1,i||1),this.feedback=new AudioletParameter(this,2,n||.5),this.mix=new AudioletParameter(this,3,s||1);e*this.audiolet.device.sampleRate;this.buffers=[],this.readWriteIndex=0};extend(FeedbackDelay,AudioletNode),FeedbackDelay.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.audiolet.output.device.sampleRate,n=this.delayTime.getValue()*i,s=this.feedback.getValue(),r=this.mix.getValue(),o=t.samples.length,a=this.buffers.length,h=0;o>h;h++){if(h>=a){var u=this.maximumDelayTime*i;this.buffers.push(new Float32Array(u))}var l=this.buffers[h],f=t.samples[h],c=l[this.readWriteIndex];e.samples[h]=r*c+(1-r)*f,l[this.readWriteIndex]=f+s*c}this.readWriteIndex+=1,this.readWriteIndex>=n&&(this.readWriteIndex=0)},FeedbackDelay.prototype.toString=function(){return"Feedback Delay"};var FFT=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.bufferSize=e,this.readWriteIndex=0,this.buffer=new Float32Array(this.bufferSize),this.realBuffer=new Float32Array(this.bufferSize),this.imaginaryBuffer=new Float32Array(this.bufferSize),this.reverseTable=new Uint32Array(this.bufferSize),this.calculateReverseTable()};extend(FFT,AudioletNode),FFT.prototype.generate=function(){var t=this.inputs[0],e=this.outputs[0];0!=t.samples.length&&(this.buffer[this.readWriteIndex]=t.samples[0],e.samples[0]=[this.realBuffer[this.readWriteIndex],this.imaginaryBuffer[this.readWriteIndex]],this.readWriteIndex+=1,this.readWriteIndex>=this.bufferSize&&(this.transform(),this.readWriteIndex=0))},FFT.prototype.calculateReverseTable=function(){for(var t=1,e=this.bufferSize>>1;t<this.bufferSize;){for(var i=0;t>i;i++)this.reverseTable[i+t]=this.reverseTable[i]+e;t<<=1,e>>=1
}},FFT.prototype.transform=function(){for(var t=0;t<this.bufferSize;t++)this.realBuffer[t]=this.buffer[this.reverseTable[t]],this.imaginaryBuffer[t]=0;for(var e=1;e<this.bufferSize;){for(var i=Math.cos(-Math.PI/e),n=Math.sin(-Math.PI/e),s=1,r=0,o=0;e>o;o++){for(var t=o;t<this.bufferSize;){var a=t+e,h=s*this.realBuffer[a]-r*this.imaginaryBuffer[a],u=s*this.imaginaryBuffer[a]+r*this.realBuffer[a];this.realBuffer[a]=this.realBuffer[t]-h,this.imaginaryBuffer[a]=this.imaginaryBuffer[t]-u,this.realBuffer[t]+=h,this.imaginaryBuffer[t]+=u,t+=e<<1}var l=s;s=l*i-r*n,r=l*n+r*i}e<<=1}},FFT.prototype.toString=function(){return"FFT"};var Multiply=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.value=new AudioletParameter(this,1,e||1)};extend(Multiply,AudioletNode),Multiply.prototype.generate=function(){for(var t=this.value.getValue(),e=this.inputs[0],i=e.samples.length,n=0;i>n;n++)this.outputs[0].samples[n]=e.samples[n]*t},Multiply.prototype.toString=function(){return"Multiply"};var Gain=function(t,e){Multiply.call(this,t,e),this.gain=this.value};extend(Gain,Multiply),Gain.prototype.toString=function(){return"Gain"};var HighPassFilter=function(t,e){BiquadFilter.call(this,t,e)};extend(HighPassFilter,BiquadFilter),HighPassFilter.prototype.calculateCoefficients=function(t){var e=2*Math.PI*t/this.audiolet.device.sampleRate,i=Math.cos(e),n=Math.sin(e),s=n/(2/Math.sqrt(2));this.b0=(1+i)/2,this.b1=-(1+i),this.b2=this.b0,this.a0=1+s,this.a1=-2*i,this.a2=1-s},HighPassFilter.prototype.toString=function(){return"High Pass Filter"};var IFFT=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.bufferSize=e,this.readWriteIndex=0,this.buffer=new Float32Array(this.bufferSize),this.realBuffer=new Float32Array(this.bufferSize),this.imaginaryBuffer=new Float32Array(this.bufferSize),this.reverseTable=new Uint32Array(this.bufferSize),this.calculateReverseTable(),this.reverseReal=new Float32Array(this.bufferSize),this.reverseImaginary=new Float32Array(this.bufferSize)};extend(IFFT,AudioletNode),IFFT.prototype.generate=function(){var t=this.inputs[0],e=this.outputs[0];if(t.samples.length){var i=t.samples[0];this.realBuffer[this.readWriteIndex]=i[0],this.imaginaryBuffer[this.readWriteIndex]=i[1],e.samples[0]=this.buffer[this.readWriteIndex],this.readWriteIndex+=1,this.readWriteIndex>=this.bufferSize&&(this.transform(),this.readWriteIndex=0)}},IFFT.prototype.calculateReverseTable=function(){for(var t=1,e=this.bufferSize>>1;t<this.bufferSize;){for(var i=0;t>i;i++)this.reverseTable[i+t]=this.reverseTable[i]+e;t<<=1,e>>=1}},IFFT.prototype.transform=function(){for(var t=1,e=0;e<this.bufferSize;e++)this.imaginaryBuffer[e]*=-1;for(var e=0;e<this.bufferSize;e++)this.reverseReal[e]=this.realBuffer[this.reverseTable[e]],this.reverseImaginary[e]=this.imaginaryBuffer[this.reverseTable[e]];for(this.realBuffer.set(this.reverseReal),this.imaginaryBuffer.set(this.reverseImaginary);t<this.bufferSize;){for(var i=Math.cos(-Math.PI/t),n=Math.sin(-Math.PI/t),s=1,r=0,o=0;t>o;o++){for(e=o;e<this.bufferSize;){var a=e+t,h=s*this.realBuffer[a]-r*this.imaginaryBuffer[a],u=s*this.imaginaryBuffer[a]+r*this.realBuffer[a];this.realBuffer[a]=this.realBuffer[e]-h,this.imaginaryBuffer[a]=this.imaginaryBuffer[e]-u,this.realBuffer[e]+=h,this.imaginaryBuffer[e]+=u,e+=t<<1}var l=s;s=l*i-r*n,r=l*n+r*i}t<<=1}for(e=0;e<this.bufferSize;e++)this.buffer[e]=this.realBuffer[e]/this.bufferSize},IFFT.prototype.toString=function(){return"IFFT"};var Lag=function(t,e,i){AudioletNode.call(this,t,2,1),this.value=new AudioletParameter(this,0,e||0),this.lag=new AudioletParameter(this,1,i||1),this.lastValue=0,this.log001=Math.log(.001)};extend(Lag,AudioletNode),Lag.prototype.generate=function(){var t=(this.inputs[0],this.outputs[0]),e=this.audiolet.device.sampleRate,i=this.value.getValue(),n=this.lag.getValue(),s=Math.exp(this.log001/(n*e)),r=(1-s)*i+s*this.lastValue;t.samples[0]=r,this.lastValue=r},Lag.prototype.toString=function(){return"Lag"};var Limiter=function(t,e,i,n){AudioletNode.call(this,t,4,1),this.linkNumberOfOutputChannels(0,0),this.threshold=new AudioletParameter(this,1,e||.95),this.attack=new AudioletParameter(this,2,i||.01),this.release=new AudioletParameter(this,2,n||.4),this.followers=[]};extend(Limiter,AudioletNode),Limiter.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.audiolet.device.sampleRate,n=Math.pow(.01,1/(this.attack.getValue()*i)),s=Math.pow(.01,1/(this.release.getValue()*i)),r=this.threshold.getValue(),o=t.samples.length,a=0;o>a;a++){a>=this.followers.length&&this.followers.push(0);var h=this.followers[a],u=t.samples[a],l=Math.abs(u);h=l>h?n*(h-l)+l:s*(h-l)+l;var f=h-r;e.samples[a]=f>0?u/(1+f):u,this.followers[a]=h}},Limiter.prototype.toString=function(){return"Limiter"};var LinearCrossFade=function(t,e){AudioletNode.call(this,t,3,1),this.linkNumberOfOutputChannels(0,0),this.position=new AudioletParameter(this,2,e||.5)};extend(LinearCrossFade,AudioletNode),LinearCrossFade.prototype.generate=function(){for(var t=this.inputs[0],e=this.inputs[1],i=this.outputs[0],n=this.position.getValue(),s=1-n,r=n,o=i.samples.length,a=0;o>a;a++){var h=t.samples[a]||0,u=e.samples[a]||0;i.samples[a]=h*s+u*r}},LinearCrossFade.prototype.toString=function(){return"Linear Cross Fader"};var LowPassFilter=function(t,e){BiquadFilter.call(this,t,e)};extend(LowPassFilter,BiquadFilter),LowPassFilter.prototype.calculateCoefficients=function(t){var e=2*Math.PI*t/this.audiolet.device.sampleRate,i=Math.cos(e),n=Math.sin(e),s=n/(2/Math.sqrt(2));this.b0=(1-i)/2,this.b1=1-i,this.b2=this.b0,this.a0=1+s,this.a1=-2*i,this.a2=1-s},LowPassFilter.prototype.toString=function(){return"Low Pass Filter"};var Pan=function(t,e){if(AudioletNode.call(this,t,2,1),this.setNumberOfOutputChannels(0,2),null==e)var e=.5;this.pan=new AudioletParameter(this,1,e)};extend(Pan,AudioletNode),Pan.prototype.generate=function(){var t=this.inputs[0],e=this.outputs[0],i=this.pan.getValue(),n=t.samples[0]||0,s=i*Math.PI/2;e.samples[0]=n*Math.cos(s),e.samples[1]=n*Math.sin(s)},Pan.prototype.toString=function(){return"Stereo Panner"};var PercussiveEnvelope=function(t,e,i,n,s){var r=[0,1,0],o=[i,n];Envelope.call(this,t,e,r,o,null,s),this.attack=this.times[0],this.release=this.times[1]};extend(PercussiveEnvelope,Envelope),PercussiveEnvelope.prototype.toString=function(){return"Percussive Envelope"};var Pulse=function(t,e,i){AudioletNode.call(this,t,2,1),this.frequency=new AudioletParameter(this,0,e||440),this.pulseWidth=new AudioletParameter(this,1,i||.5),this.phase=0};extend(Pulse,AudioletNode),Pulse.prototype.generate=function(){var t=this.pulseWidth.getValue();this.outputs[0].samples[0]=this.phase<t?1:-1;var e=this.frequency.getValue(),i=this.audiolet.device.sampleRate;this.phase+=e/i,this.phase>1&&(this.phase%=1)},Pulse.prototype.toString=function(){return"Pulse"};var Reverb=function(t,e,i,n){AudioletNode.call(this,t,4,1),this.initialMix=.33,this.fixedGain=.015,this.initialDamping=.5,this.scaleDamping=.4,this.initialRoomSize=.5,this.scaleRoom=.28,this.offsetRoom=.7,this.combTuning=[1116,1188,1277,1356,1422,1491,1557,1617],this.allPassTuning=[556,441,341,225];var e=e||this.initialMix;this.mix=new AudioletParameter(this,1,e);var i=i||this.initialRoomSize;this.roomSize=new AudioletParameter(this,2,i);var n=n||this.initialDamping;this.damping=new AudioletParameter(this,3,n),this.combBuffers=[],this.combIndices=[],this.filterStores=[];for(var s=this.combTuning.length,r=0;s>r;r++)this.combBuffers.push(new Float32Array(this.combTuning[r])),this.combIndices.push(0),this.filterStores.push(0);this.allPassBuffers=[],this.allPassIndices=[];for(var o=this.allPassTuning.length,r=0;o>r;r++)this.allPassBuffers.push(new Float32Array(this.allPassTuning[r])),this.allPassIndices.push(0)};extend(Reverb,AudioletNode),Reverb.prototype.generate=function(){var t=this.mix.getValue(),e=this.roomSize.getValue(),i=this.damping.getValue(),n=this.combTuning.length,s=this.allPassTuning.length,r=this.inputs[0].samples[0]||0,o=r;r*=this.fixedGain;for(var a=r,i=i*this.scaleDamping,h=e*this.scaleRoom+this.offsetRoom,u=0;n>u;u++){var l=this.combIndices[u],f=this.combBuffers[u],c=this.filterStores[u],p=f[l];c=p*(1-i)+c*i,r+=p,f[l]=a+h*c,l+=1,l>=f.length&&(l=0),this.combIndices[u]=l,this.filterStores[u]=c}for(var u=0;s>u;u++){var d=this.allPassBuffers[u],m=this.allPassIndices[u],v=r,g=d[m];r=-r+g,d[m]=v+.5*g,m+=1,m>=d.length&&(m=0),this.allPassIndices[u]=m}this.outputs[0].samples[0]=t*r+(1-t)*o},Reverb.prototype.toString=function(){return"Reverb"};var Saw=function(t,e){AudioletNode.call(this,t,1,1),this.frequency=new AudioletParameter(this,0,e||440),this.phase=0};extend(Saw,AudioletNode),Saw.prototype.generate=function(){var t=this.outputs[0],e=this.frequency.getValue(),i=this.audiolet.device.sampleRate;t.samples[0]=4*((this.phase/2+.25)%.5-.25),this.phase+=e/i,this.phase>1&&(this.phase%=1)},Saw.prototype.toString=function(){return"Saw"};var SoftClip=function(t){AudioletNode.call(this,t,1,1),this.linkNumberOfOutputChannels(0,0)};extend(SoftClip,AudioletNode),SoftClip.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=t.samples.length,n=0;i>n;n++){var s=t.samples[n];e.samples[n]=s>.5||-.5>s?(Math.abs(s)-.25)/s:s}},SoftClip.prototype.toString=function(){return"SoftClip"};var Square=function(t,e){AudioletNode.call(this,t,1,1),this.frequency=new AudioletParameter(this,0,e||440),this.phase=0};extend(Square,AudioletNode),Square.prototype.generate=function(){var t=this.outputs[0],e=this.frequency.getValue(),i=this.audiolet.device.sampleRate;t.samples[0]=this.phase>.5?1:-1,this.phase+=e/i,this.phase>1&&(this.phase%=1)},Square.prototype.toString=function(){return"Square"};var Triangle=function(t,e){AudioletNode.call(this,t,1,1),this.frequency=new AudioletParameter(this,0,e||440),this.phase=0};extend(Triangle,AudioletNode),Triangle.prototype.generate=function(){var t=this.outputs[0],e=this.frequency.getValue(),i=this.audiolet.device.sampleRate;t.samples[0]=1-4*Math.abs((this.phase+.25)%1-.5),this.phase+=e/i,this.phase>1&&(this.phase%=1)},Triangle.prototype.toString=function(){return"Triangle"};var TriggerControl=function(t,e){AudioletNode.call(this,t,0,1),this.trigger=new AudioletParameter(this,null,e||0)};extend(TriggerControl,AudioletNode),TriggerControl.prototype.generate=function(){this.trigger.getValue()>0?(this.outputs[0].samples[0]=1,this.trigger.setValue(0)):this.outputs[0].samples[0]=0},TriggerControl.prototype.toString=function(){return"Trigger Control"};var UpMixer=function(t,e){AudioletNode.call(this,t,1,1),this.outputs[0].numberOfChannels=e};extend(UpMixer,AudioletNode),UpMixer.prototype.generate=function(){var t=this.inputs[0],e=this.outputs[0],i=t.samples.length,n=e.samples.length;if(i==n)e.samples=t.samples;else for(var s=0;n>s;s++)e.samples[s]=t.samples[s%i]},UpMixer.prototype.toString=function(){return"UpMixer"};var WebKitBufferPlayer=function(t,e){AudioletNode.call(this,t,0,1),this.onComplete=e,this.isWebKit=this.audiolet.device.sink instanceof Sink.sinks.webkit,this.ready=!1,this.setNumberOfOutputChannels(0,0),this.isWebKit&&(this.context=this.audiolet.device.sink._context,this.jsNode=null,this.source=null,this.ready=!1,this.loaded=!1,this.buffers=[],this.readPosition=0,this.endTime=null)};extend(WebKitBufferPlayer,AudioletNode),WebKitBufferPlayer.prototype.load=function(t,e,i){this.isWebKit&&(this.stop(),this.xhr=new XMLHttpRequest,this.xhr.open("GET",t,!0),this.xhr.responseType="arraybuffer",this.xhr.onload=this.onLoad.bind(this,e,i),this.xhr.onerror=i,this.xhr.send())},WebKitBufferPlayer.prototype.stop=function(){this.ready=!1,this.loaded=!1,this.buffers=[],this.readPosition=0,this.endTime=null,this.setNumberOfOutputChannels(0),this.disconnectWebKitNodes()},WebKitBufferPlayer.prototype.disconnectWebKitNodes=function(){this.source&&this.jsNode&&(this.source.disconnect(this.jsNode),this.jsNode.disconnect(this.context.destination),this.source=null,this.jsNode=null)},WebKitBufferPlayer.prototype.onLoad=function(t,e){this.context.decodeAudioData(this.xhr.response,function(e){this.onDecode(e),t()}.bind(this),e)},WebKitBufferPlayer.prototype.onDecode=function(t){this.fileBuffer=t,this.source=this.context.createBufferSource(),this.source.buffer=this.fileBuffer;var e=this.fileBuffer.numberOfChannels;this.setNumberOfOutputChannels(0,e),this.jsNode=this.context.createJavaScriptNode(4096,e,0),this.jsNode.onaudioprocess=this.onData.bind(this),this.source.connect(this.jsNode),this.jsNode.connect(this.context.destination),this.source.noteOn(0),this.endTime=this.context.currentTime+this.fileBuffer.duration,this.loaded=!0},WebKitBufferPlayer.prototype.onData=function(t){this.loaded&&(this.ready=!0);for(var e=t.inputBuffer.numberOfChannels,i=0;e>i;i++)this.buffers[i]=t.inputBuffer.getChannelData(i),this.readPosition=0},WebKitBufferPlayer.prototype.generate=function(){if(this.ready){for(var t=this.outputs[0],e=t.samples.length,i=0;e>i;i++)t.samples[i]=this.buffers[i][this.readPosition];this.readPosition+=1,this.context.currentTime>this.endTime&&(this.stop(),this.onComplete())}};var WhiteNoise=function(t){AudioletNode.call(this,t,0,1)};extend(WhiteNoise,AudioletNode),WhiteNoise.prototype.generate=function(){this.outputs[0].samples[0]=2*Math.random()-1},WhiteNoise.prototype.toString=function(){return"White Noise"};var Add=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.value=new AudioletParameter(this,1,e||0)};extend(Add,AudioletNode),Add.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.value.getValue(),n=t.samples.length,s=0;n>s;s++)e.samples[s]=t.samples[s]+i},Add.prototype.toString=function(){return"Add"};var Divide=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.value=new AudioletParameter(this,1,e||1)};extend(Divide,AudioletNode),Divide.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.value.getValue(),n=t.samples.length,s=0;n>s;s++)e.samples[s]=t.samples[s]/i},Divide.prototype.toString=function(){return"Divide"};var Modulo=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.value=new AudioletParameter(this,1,e||1)};extend(Modulo,AudioletNode),Modulo.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.value.getValue(),n=t.samples.length,s=0;n>s;s++)e.samples[s]=t.samples[s]%i},Modulo.prototype.toString=function(){return"Modulo"};var MulAdd=function(t,e,i){AudioletNode.call(this,t,3,1),this.linkNumberOfOutputChannels(0,0),this.mul=new AudioletParameter(this,1,e||1),this.add=new AudioletParameter(this,2,i||0)};extend(MulAdd,AudioletNode),MulAdd.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.mul.getValue(),n=this.add.getValue(),s=t.samples.length,r=0;s>r;r++)e.samples[r]=t.samples[r]*i+n},MulAdd.prototype.toString=function(){return"Multiplier/Adder"};var Reciprocal=function(t){AudioletNode.call(this,t,1,1),this.linkNumberOfOutputChannels(0,0)};extend(Reciprocal,AudioletNode),Reciprocal.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=t.samples.length,n=0;i>n;n++)e.samples[n]=1/t.samples[n]},Reciprocal.prototype.toString=function(){return"Reciprocal"};var Subtract=function(t,e){AudioletNode.call(this,t,2,1),this.linkNumberOfOutputChannels(0,0),this.value=new AudioletParameter(this,1,e||0)};extend(Subtract,AudioletNode),Subtract.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=this.value.getValue(),n=t.samples.length,s=0;n>s;s++)e.samples[s]=t.samples[s]-i},Subtract.prototype.toString=function(){return"Subtract"};var Tanh=function(t){AudioletNode.call(this,t,1,1),this.linkNumberOfOutputChannels(0,0)};extend(Tanh,AudioletNode),Tanh.prototype.generate=function(){for(var t=this.inputs[0],e=this.outputs[0],i=t.samples.length,n=0;i>n;n++){var s=t.samples[n];e.samples[n]=(Math.exp(s)-Math.exp(-s))/(Math.exp(s)+Math.exp(-s))}},Tanh.prototype.toString=function(){return"Tanh"};var Pattern=function(){};Pattern.prototype.next=function(){return null},Pattern.prototype.valueOf=function(t){return t instanceof Pattern?t.next():t},Pattern.prototype.reset=function(){};var PArithmetic=function(t,e,i){Pattern.call(this),this.start=t,this.value=t,this.step=e,this.repeats=i,this.position=0};extend(PArithmetic,Pattern),PArithmetic.prototype.next=function(){var t;if(0==this.position)t=this.value,this.position+=1;else if(this.position<this.repeats){var e=this.valueOf(this.step);null!=e?(this.value+=e,t=this.value,this.position+=1):t=null}else t=null;return t},PArithmetic.prototype.reset=function(){this.value=this.start,this.position=0,this.step instanceof Pattern&&this.step.reset()};var Pseries=PArithmetic,PChoose=function(t,e){Pattern.call(this),this.list=t,this.repeats=e||1,this.position=0};extend(PChoose,Pattern),PChoose.prototype.next=function(){var t;if(this.position<this.repeats){var e=Math.floor(Math.random()*this.list.length),i=this.list[e],n=this.valueOf(i);null!=n?(i instanceof Pattern||(this.position+=1),t=n):(i instanceof Pattern&&i.reset(),this.position+=1,t=this.next())}else t=null;return t},PChoose.prototype.reset=function(){this.position=0;for(var t=0;t<this.list.length;t++){var e=this.list[t];e instanceof Pattern&&e.reset()}};var Prand=PChoose,PGeometric=function(t,e,i){Pattern.call(this),this.start=t,this.value=t,this.step=e,this.repeats=i,this.position=0};extend(PGeometric,Pattern),PGeometric.prototype.next=function(){var t;if(0==this.position)t=this.value,this.position+=1;else if(this.position<this.repeats){var e=this.valueOf(this.step);null!=e?(this.value*=e,t=this.value,this.position+=1):t=null}else t=null;return t},PGeometric.prototype.reset=function(){this.value=this.start,this.position=0,this.step instanceof Pattern&&this.step.reset()};var Pgeom=PGeometric,PProxy=function(t){Pattern.call(this),t&&(this.pattern=t)};extend(PProxy,Pattern),PProxy.prototype.next=function(){var t;if(this.pattern)var t=this.pattern.next();else t=null;return t};var Pp=PProxy,PRandom=function(t,e,i){Pattern.call(this),this.low=t,this.high=e,this.repeats=i,this.position=0};extend(PRandom,Pattern),PRandom.prototype.next=function(){var t;if(this.position<this.repeats){var e=this.valueOf(this.low),i=this.valueOf(this.high);null!=e&&null!=i?(t=e+Math.random()*(i-e),this.position+=1):t=null}else t=null;return t},PRandom.prototype.reset=function(){this.position=0};var Pwhite=PRandom,PSequence=function(t,e,i){Pattern.call(this),this.list=t,this.repeats=e||1,this.position=0,this.offset=i||0};extend(PSequence,Pattern),PSequence.prototype.next=function(){var t;if(this.position<this.repeats*this.list.length){var e=(this.position+this.offset)%this.list.length,i=this.list[e],n=this.valueOf(i);null!=n?(i instanceof Pattern||(this.position+=1),t=n):(i instanceof Pattern&&i.reset(),this.position+=1,t=this.next())}else t=null;return t},PSequence.prototype.reset=function(){this.position=0;for(var t=0;t<this.list.length;t++){var e=this.list[t];e instanceof Pattern&&e.reset()}};var Pseq=PSequence,PSeries=function(t,e,i){Pattern.call(this),this.list=t,this.repeats=e||1,this.position=0,this.offset=i||0};extend(PSeries,Pattern),PSeries.prototype.next=function(){var t;if(this.position<this.repeats){var e=(this.position+this.offset)%this.list.length,i=this.list[e],n=this.valueOf(i);null!=n?(i instanceof Pattern||(this.position+=1),t=n):(i instanceof Pattern&&i.reset(),this.position+=1,t=this.next())}else t=null;return t},PSeries.prototype.reset=function(){this.position=0;for(var t=0;t<this.list.length;t++){var e=this.list[t];e instanceof Pattern&&e.reset()}};var Pser=PSeries,PShuffle=function(t,e){for(Pattern.call(this),this.list=[];t.length;){var i=Math.floor(Math.random()*t.length),n=t.splice(i,1);this.list.push(n)}this.repeats=e,this.position=0};extend(PShuffle,Pattern),PShuffle.prototype.next=function(){var t;if(this.position<this.repeats*this.list.length){var e=(this.position+this.offset)%this.list.length,i=this.list[e],n=this.valueOf(i);null!=n?(i instanceof Pattern||(this.position+=1),t=n):(i instanceof Pattern&&i.reset(),this.position+=1,t=this.next())}else t=null;return t};var Pshuffle=PShuffle,Scale=function(t,e){this.degrees=t,this.tuning=e||new EqualTemperamentTuning(12)};Scale.prototype.getFrequency=function(t,e,i){var n=e;return i+=Math.floor(t/this.degrees.length),t%=this.degrees.length,n*=Math.pow(this.tuning.octaveRatio,i),n*=this.tuning.ratios[this.degrees[t]]};var MajorScale=function(){Scale.call(this,[0,2,4,5,7,9,11])};extend(MajorScale,Scale);var MinorScale=function(){Scale.call(this,[0,2,3,5,7,8,10])};extend(MinorScale,Scale);var Tuning=function(t,e){this.semitones=t,this.octaveRatio=e||2,this.ratios=[];for(var i=this.semitones.length,n=0;i>n;n++)this.ratios.push(Math.pow(2,this.semitones[n]/i))},EqualTemperamentTuning=function(t){for(var e=[],i=0;t>i;i++)e.push(i);Tuning.call(this,e,2)};extend(EqualTemperamentTuning,Tuning);var Sink=this.Sink=function(t){function e(t,i,n,s){var r,o=e.sinks.list;for(r=0;r<o.length;r++)if(o[r].enabled)try{return new o[r](t,i,n,s)}catch(a){}throw e.Error(2)}function i(){}function n(t,i,s,r,o){s=s||i.prototype,i.prototype=new e.SinkClass,i.prototype.type=t,i.enabled=!r;var a;for(a in s)s.hasOwnProperty(a)&&(i.prototype[a]=s[a]);n[t]=i,n.list[o?"unshift":"push"](i)}return e.SinkClass=i,i.prototype=e.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,channelMode:"interleaved",isReady:!1,start:function(t,i,n,s){this.channelCount=isNaN(i)||null===i?this.channelCount:i,this.bufferSize=isNaN(n)||null===n?this.bufferSize:n,this.sampleRate=isNaN(s)||null===s?this.sampleRate:s,this.readFn=t,this.activeRecordings=[],this.previousHit=+new Date,e.EventEmitter.call(this),e.emit("init",[this].concat([].slice.call(arguments)))},process:function(t,i){if(this.emit("preprocess",arguments),this.ringBuffer&&("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments),"interleaved"===this.channelMode)this.emit("audioprocess",arguments),this.readFn&&this.readFn.apply(this,arguments);else{var n=e.deinterleave(t,this.channelCount),s=[n].concat([].slice.call(arguments,1));this.emit("audioprocess",s),this.readFn&&this.readFn.apply(this,s),e.interleave(n,this.channelCount,t)}this.emit("postprocess",arguments),this.previousHit=+new Date,this.writePosition+=t.length/i},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ready:function(){this.isReady||(this.isReady=!0,this.emit("ready",[]))}},e.sinks=e.devices=n,e.sinks.list=[],e.singleton=function(){var t=e.apply(null,arguments);return e.singleton=function(){return t},t},t.Sink=e,e}(function(){return this}());void function(t){function e(){var t;for(t in e.prototype)e.prototype.hasOwnProperty(t)&&(this[t]=e.prototype[t]);this._listeners={}}e.prototype={_listeners:null,emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].apply(this,e);return this},on:function(t,e){return this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this},off:function(t,e){if(this._listeners[t]){if(!e)return delete this._listeners[t],this;for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i]===e&&this._listeners[t].splice(i--,1);this._listeners[t].length||delete this._listeners[t]}return this}},t.EventEmitter=e,e.call(t)}(this.Sink),void function(t){t.doInterval=function(e,i){function n(n){t.inlineWorker.working&&!n?(s=t.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+i+");"),s.onmessage=function(){e()},r=function(){s.terminate()}):(s=setInterval(e,i),r=function(){clearInterval(s)})}var s,r;return t.inlineWorker.ready?n():t.inlineWorker.on("ready",function(){n()}),function(){r?r():t.inlineWorker.ready||t.inlineWorker.on("ready",function(){r&&r()})}}}(this.Sink),void function(t){var e,i,n,s;void function(t,r){function o(t,e){var i,n=e.slice();for(i=n.shift();"undefined"!=typeof i;i=n.shift())if(i=Function("return typeof "+i+t+'=== "undefined" ? undefined : '+i+t)())return i}e=o("Blob",t),i=o("BlobBuilder",t),n=o("URL",r),s=o("btoa",[""])}(["","Moz","WebKit","MS"],["","webkit"]);var r=e&&n&&function(t,i){return n.createObjectURL(new e([t],{type:i}))},o=i&&n&&function(t,e){var s=new i;return s.append(t),n.createObjectURL(s.getBlob(e))},a=s&&function(t,e){return"data:"+e+";base64,"+s(t)},h=r||o||a;h&&(r&&(h.createBlob=r),o&&(h.createBlobBuilder=o),a&&(h.createData=a),e&&(h.Blob=e),i&&(h.BlobBuilder=i),n&&(h.URL=n),t.createDynURL=h,t.revokeDynURL=function(t){return"string"==typeof t&&0===t.indexOf("data:")?!1:n.revokeObjectURL(t)})}(this.Sink),void function(t){function e(t){if(!e.hasOwnProperty(t))throw e(1);if(!(this instanceof e))return new e(t);var i;for(i in e[t])e[t].hasOwnProperty(i)&&(this[i]=e[t][i]);this.code=t}e.prototype=new Error,e.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message},e[1]={message:"No such error code.",explanation:"The error code does not exist."},e[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."},e[16]={message:"Buffer underflow.",explanation:"Trying to recover..."},e[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."},e[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."},t.Error=e}(this.Sink),void function(t){function e(){return n(this,"terminate",this._terminate),t.revokeDynURL(this._url),delete this._url,delete this._terminate,this.terminate()}function i(s){function r(t,s,r){try{var o=t(s,"text/javascript"),a=new Worker(o);return n(a,"_url",o),n(a,"_terminate",a.terminate),n(a,"terminate",e),i.type?a:(i.type=r,i.createURL=t,a)}catch(h){return null}}var o,a=t.createDynURL;return i.createURL?r(i.createURL,s,i.type):(o=r(a.createBlob,s,"blob"))?o:(o=r(a.createBlobBuilder,s,"blobbuilder"))?o:o=r(a.createData,s,"data")}var n=Object.defineProperty?function(t,e,i){Object.defineProperty(t,e,{value:i,configurable:!0,writable:!0})}:function(t,e,i){t[e]=i};t.EventEmitter.call(i),i.test=function(){function t(t){i.ready||(i.ready=!0,i.working=t,i.emit("ready",[t]),i.off("ready"),t&&e&&e.terminate(),e=null)}i.ready=i.working=!1,i.type="",i.createURL=null;var e=i("this.onmessage=function(e){postMessage(e.data)}"),n="inlineWorker";e?(e.onmessage=function(e){t(e.data===n)},e.postMessage(n),setTimeout(function(){t(!1)},1e3)):setTimeout(function(){t(!1)},0)},t.inlineWorker=i,i.test()}(this.Sink),void function(t){t.sinks("audiodata",function(){function e(){if(u){if(i=l.mozWriteAudio(u),h+=i,i<u.length)return u=u.subarray(i);u=null}if(n=l.mozCurrentSampleOffset(),s=Number(n+(o!==n?a.bufferSize:a.preBufferSize)*a.channelCount-h),n===o&&a.emit("error",[t.Error(16)]),s>0||o===n){a.ready();try{r=new Float32Array(o===n?a.preBufferSize*a.channelCount:a.forceBufferSize&&s<2*a.bufferSize?2*a.bufferSize:s)}catch(e){return a.emit("error",[t.Error(18)]),void a.kill()}a.process(r,a.channelCount),i=a._audio.mozWriteAudio(r),i<r.length&&(u=r.subarray(i)),h+=i}o=n}var i,n,s,r,o,a=this,h=0,u=null,l=new Audio;a.start.apply(a,arguments),a.preBufferSize=isNaN(arguments[4])||null===arguments[4]?this.preBufferSize:arguments[4],l.mozSetup(a.channelCount,a.sampleRate),this._timers=[],this._timers.push(t.doInterval(function(){+new Date-a.previousHit>2e3&&(a._audio=l=new Audio,l.mozSetup(a.channelCount,a.sampleRate),h=0,a.emit("error",[t.Error(17)]))},1e3)),this._timers.push(t.doInterval(e,a.interval)),a._bufferFill=e,a._audio=l},{bufferSize:24576,preBufferSize:24576,forceBufferSize:!1,interval:100,kill:function(){for(;this._timers.length;)this._timers.shift()();this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}},!1,!0),t.sinks.moz=t.sinks.audiodata}(this.Sink),void function(t){t.sinks("dummy",function(){function e(){var t=new Float32Array(i.bufferSize*i.channelCount);i.process(t,i.channelCount)}var i=this;i.start.apply(i,arguments),i._kill=t.doInterval(e,i.bufferSize/i.sampleRate*1e3),i._callback=e},{kill:function(){this._kill(),this.emit("kill")}},!0)}(this.Sink),function(t,e){function i(t){var e=document.createElement("audio");return t&&(e.src=t),e}function n(){var t=this;t.currentFrame=i(),t.nextFrame=i(),t._onended=function(){t.samples+=t.bufferSize,t.nextClip()}}e=t.sinks,e("wav",function(){function n(){s._audio.hasNextFrame||(s.ready(),t.memcpy(h,0,a,0),s.process(a,s.channelCount),s._audio.setSource("data:audio/wav;base64,"+btoa(audioLib.PCMData.encode({data:a,sampleRate:s.sampleRate,channelCount:s.channelCount,bytesPerSample:s.quality}))),s._audio.currentFrame.src||s._audio.nextClip())}var s=this,r=new e.wav.wavAudio,o="undefined"==typeof o?audioLib.PCMData:o;s.start.apply(s,arguments);var a=new Float32Array(s.bufferSize*s.channelCount),h=new Float32Array(s.bufferSize*s.channelCount);if(!i().canPlayType("audio/wav; codecs=1")||!btoa)throw 0;s.kill=t.doInterval(n,40),s._bufferFill=n,s._audio=r},{quality:1,bufferSize:22050,getPlaybackTime:function(){var t=this._audio;return(t.currentFrame?t.currentFrame.currentTime*this.sampleRate:0)+t.samples}}),n.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:!1,nextClip:function(){var t=this.currentFrame;this.currentFrame=this.nextFrame,this.nextFrame=t,this.hasNextFrame=!1,this.currentFrame.play()},setSource:function(t){this.nextFrame.src=t,this.nextFrame.addEventListener("ended",this._onended,!0),this.hasNextFrame=!0}},e.wav.wavAudio=n}(this.Sink),function(t,e){var i="undefined"==typeof window?null:window.webkitAudioContext||window.AudioContext;t("webaudio",function(){function i(t){var e,i,s=t.outputBuffer,r=s.numberOfChannels,h=s.length,u=(s.size,new Array(r));for(n.ready(),o=o&&o.length===h*r?o:new Float32Array(h*r),a=a&&a.length===o.length?a:new Float32Array(h*r),o.set(a),e=0;r>e;e++)u[e]=s.getChannelData(e);for(n.process(o,n.channelCount),e=0;h>e;e++)for(i=0;r>i;i++)u[i][e]=o[e*n.channelCount+i]}var n=this,s=t.webaudio.getContext(),r=null,o=null,a=null;n.start.apply(n,arguments),r=s.createScriptProcessor(n.bufferSize,n.channelCount,n.channelCount),n.sampleRate=s.sampleRate,r.onaudioprocess=i,r.connect(s.destination),n._context=s,n._node=r,n._callback=i,e.push(r)},{kill:function(){this._node.disconnect(0);for(var t=0;t<e.length;t++)e[t]===this._node&&e.splice(t--,1);this._node=this._context=null,this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}},!1,!0),t.webkit=t.webaudio,t.webaudio.fix82795=e,t.webaudio.getContext=function(){var e=new i;return t.webaudio.getContext=function(){return e},e}}(this.Sink.sinks,[]),function(t){t.sinks("worker",function(){function t(t){i.isReady||i.initMSP(t),i.ready();var e,n,a=i.channelCount,h=t.audioLength;for(s=s&&s.length===h*a?s:new Float32Array(h*a),r=r&&r.length===s.length?r:new Float32Array(h*a),o=o&&o.length===s.length?o:new Float32Array(h*a),s.set(o),r.set(o),i.process(s,i.channelCount),e=0;a>e;e++)for(n=0;h>n;n++)r[e*t.audioLength+n]=s[e+n*a];t.writeAudio(r)}function e(t){i.isReady||i.initWA(t),i.ready();var e,n,r=t.outputBuffer,a=r.numberOfChannels,h=r.length,u=(r.size,new Array(a));for(s=s&&s.length===h*a?s:new Float32Array(h*a),o=o&&o.length===s.length?o:new Float32Array(h*a),s.set(o),e=0;a>e;e++)u[e]=r.getChannelData(e);for(i.process(s,i.channelCount),e=0;h>e;e++)for(n=0;a>n;n++)u[n][e]=s[e*i.channelCount+n]}var i=this,n=function(){return this}(),s=null,r=null,o=null;i.start.apply(i,arguments),importScripts(),n.onprocessmedia=t,n.onaudioprocess=e,i._mspBufferFill=t,i._waBufferFill=e},{ready:!1,initMSP:function(t){this.channelCount=t.audioChannels,this.sampleRate=t.audioSampleRate,this.bufferSize=t.audioLength*this.channelCount,this.ready=!0,this.emit("ready",[])},initWA:function(t){var e=t.outputBuffer;
this.channelCount=e.numberOfChannels,this.sampleRate=e.sampleRate,this.bufferSize=e.length*this.channelCount,this.ready=!0,this.emit("ready",[])}})}(this.Sink),function(t){t.deinterleave=function(t,e){var i,n,s=t.length,r=s/e,o=[];for(i=0;e>i;i++)for(o[i]=new Float32Array(r),n=0;r>n;n++)o[i][n]=t[n*e+i];return o},t.interleave=function(t,e,i){e=e||t.length;var n,s,r=t[0].length,o=t.length;for(i=i||new Float32Array(r*e),n=0;o>n;n++)for(s=0;r>s;s++)i[n+s*e]=t[n][s];return i},t.mix=function(t){var e,i,n,s=[].slice.call(arguments,1);for(n=0;n<s.length;n++)for(e=Math.max(t.length,s[n].length),i=0;e>i;i++)t[i]+=s[n][i];return t},t.resetBuffer=function(t){var e,i=t.length;for(e=0;i>e;e++)t[e]=0;return t},t.clone=function(t,e){var i,n=t.length;for(e=e||new Float32Array(n),i=0;n>i;i++)e[i]=t[i];return e},t.createDeinterleaved=function(t,e){var i,n=new Array(e);for(i=0;e>i;i++)n[i]=new Float32Array(t);return n},t.memcpy=function(t,e,i,n,s){if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,s&&e+s):t.slice(e,s&&e+s):t,i.set)i.set(t,n);else for(var r=0;r<t.length;r++)i[r+n]=t[r];return i},t.memslice=function(t,e,i){return t.subarray?t.subarray(e,i):t.slice(e,i)},t.mempad=function(e,i,n){return i=i.length?i:new e.constructor(i),t.memcpy(e,0,i,n),i},t.linspace=function(t,e,i){var n,s,r,o;for(i=i.length?(n=i.length)&&i:Array(n=i),o=(e-t)/--n,r=t+o,s=1;n>s;s++,r+=o)i[s]=r;return i[0]=t,i[n]=e,i},t.ftoi=function(t,e,i){var n,s=Math.pow(2,e-1);for(i=i||new t.constructor(t.length),n=0;n<t.length;n++)i[n]=~~(s*t[n]);return i}}(this.Sink),function(t){function e(e,i){t.EventEmitter.call(this),this.bufferSize=isNaN(e)||null===e?this.bufferSize:e,this.channelCount=isNaN(i)||null===i?this.channelCount:i;var n=this;this.callback=function(){return n.process.apply(n,arguments)},this.resetBuffer()}e.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new Float32Array(this.bufferSize),this.zeroBuffer=new Float32Array(this.bufferSize)},process:function(t){null===this.offset&&this.loadBuffer();for(var e=0;e<t.length;e++)this.offset>=this.buffer.length&&this.loadBuffer(),t[e]=this.buffer[this.offset++]},loadBuffer:function(){this.offset=0,t.memcpy(this.zeroBuffer,0,this.buffer,0),this.emit("audioprocess",[this.buffer,this.channelCount])}},t.Proxy=e,t.prototype.createProxy=function(e){var i=new t.Proxy(e,this.channelCount);return i.parentSink=this,this.on("audioprocess",i.callback),i}}(this.Sink),function(t){!function(){function e(i,n){return i&&n?e[i]=n:i&&e[i]instanceof Function&&(t.interpolate=e[i]),e[i]}t.interpolation=e,e("linear",function(t,e){var i=Math.floor(e),n=i+1,s=e-i;return n=n<t.length?n:0,t[i]*(1-s)+t[n]*s}),e("nearest",function(t,e){return e>=t.length-.5?t[0]:t[Math.round(e)]}),e("linear")}(),t.resample=function(e,i,n,s,r){var o,a,h=arguments.length,u=2===h?i:3===h?i/n:s/i*r/n,l=e.length,f=Math.ceil(l/u),c=new Float32Array(f);for(o=0,a=0;l>o;o+=u)c[a++]=t.interpolate(e,o);return c}}(this.Sink),void function(t){function e(t){this.boundTo=t,this.buffers=[],t.activeRecordings.push(this)}t.on("init",function(t){t.activeRecordings=[],t.on("postprocess",t.recordData)}),t.prototype.activeRecordings=null,t.prototype.record=function(){var e=new t.Recording(this);return this.emit("record",[e]),e},t.prototype.recordData=function(t){var e,i=this.activeRecordings,n=i.length;for(e=0;n>e;e++)i[e].add(t)},e.prototype={add:function(t){this.buffers.push(t)},clear:function(){this.buffers=[]},stop:function(){var t,e=this.boundTo.activeRecordings;for(t=0;t<e.length;t++)e[t]===this&&e.splice(t--,1)},join:function(){var t,e,i,n=0,s=0,r=this.buffers,o=r.length;for(i=0;o>i;i++)n+=r[i].length;for(t=new Float32Array(n),i=0;o>i;i++){for(e=0;e<r[i].length;e++)t[s+e]=r[i][e];s+=r[i].length}return t}},t.Recording=e}(this.Sink),void function(t){function e(){this.ringBuffer&&("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}t.on("init",function(t){t.on("preprocess",e)}),t.prototype.ringBuffer=null,t.prototype.ringSpin=function(t){var e,i=this.ringBuffer,n=t.length,s=i.length,r=this.ringOffset;for(e=0;n>e;e++)t[e]+=i[r],r=(r+1)%s;this.ringOffset=r},t.prototype.ringSpinDeinterleaved=function(t){var e,i,n=this.ringBuffer,s=t.length,r=n.length,o=n[0].length,a=this.ringOffset;for(e=0;s>e;e+=r){for(i=0;r>i;i++)t[e+i]+=n[i][a];a=(a+1)%o}this.ringOffset=i}}(this.Sink),void function(t,e){e=t.prototype,t.on("init",function(t){t.asyncBuffers=[],t.syncBuffers=[],t.on("preprocess",t.writeBuffersSync),t.on("postprocess",t.writeBuffersAsync)}),e.writeMode="async",e.asyncBuffers=e.syncBuffers=null,e.writeBuffersAsync=function(t){var e,i,n,s,r,o=this.asyncBuffers,a=t.length;if(o)for(n=0;n<o.length;n++){for(e=o[n],i=e.b.length,r=e.d,e.d-=Math.min(r,a),s=0;a>s+r&&i>s;s++)t[s+r]+=e.b[s];e.b=e.b.subarray(s+r),n>=i&&o.splice(n--,1)}},e.writeBuffersSync=function(t){for(var e=this.syncBuffers,i=t.length,n=0,s=0;i>n&&e.length;n++)t[n]+=e[0][s],e[0].length<=s?(e.splice(0,1),s=0):s++;e.length&&(e[0]=e[0].subarray(s))},e.writeBufferAsync=function(e,i){e="deinterleaved"===this.mode?t.interleave(e,this.channelCount):e;var n=this.asyncBuffers;return n.push({b:e,d:isNaN(i)?~~((+new Date-this.previousHit)/1e3*this.sampleRate):i}),n.length},e.writeBufferSync=function(e){e="deinterleaved"===this.mode?t.interleave(e,this.channelCount):e;var i=this.syncBuffers;return i.push(e),i.length},e.writeBuffer=function(){return this["async"===this.writeMode?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},e.getSyncWriteOffset=function(){var t,e=this.syncBuffers,i=0;for(t=0;t<e.length;t++)i+=e[t].length;return i}}(this.Sink);var MUSIC={notes:{Fb:[6,-10],Cb:[5,-9],Gb:[5,-8],Db:[4,-7],Ab:[4,-6],Eb:[3,-5],Bb:[3,-4],F:[2,-3],C:[1,-2],G:[1,-1],D:[0,0],A:[0,1],E:[-1,2],B:[-1,3],"F#":[-2,4],"C#":[-3,5],"G#":[-3,6],"D#":[-4,7],"A#":[-4,8],"E#":[-5,9],"B#":[-5,10]},baseFreq:440,baseOffset:[4,1],intervals:{unison:[0,0],"minor second":[3,-5],"major second":[-1,2],"minor third":[2,-3],"major third":[-2,4],fourth:[1,-1],"augmented fourth":[-3,6],tritone:[-3,6],"diminished fifth":[4,-6],fifth:[0,1],"minor sixth":[3,-4],"major sixth":[-1,3],"minor seventh":[2,-2],"major seventh":[-2,5],octave:[1,0]},intervals_semitones:{0:[0,0],1:[3,-5],2:[-1,2],3:[2,-3],4:[-2,4],5:[1,-1],6:[-3,6],7:[0,1],8:[3,-4],9:[-1,3],10:[2,-2],11:[-2,5],12:[1,0]},scales:{major:["major second","major third","fourth","fifth","major sixth","major seventh"],"natural minor":["major second","minor third","fourth","fifth","minor sixth","minor seventh"],"harmonic minor":["major second","minor third","fourth","fifth","minor sixth","major seventh"],"major pentatonic":["major second","major third","fifth","major sixth"],"minor pentatonic":["minor third","fourth","minor sixth","minor seventh"]}};Note.prototype.frequency=function(){return MUSIC.baseFreq*Math.pow(2,(1200*this.coord[0]+700*this.coord[1])/1200)},Note.prototype.accidental=function(){return Math.round((this.coord[1]+MUSIC.baseOffset[1])/7)},Note.prototype.octave=function(){var t=this.accidental();return this.coord[0]+MUSIC.baseOffset[0]+4*t+Math.floor((this.coord[1]+MUSIC.baseOffset[1]-7*t)/2)},Note.prototype.latin=function(){var t=["F","C","G","D","A","E","B"],e=["bb","b","","#","x"],i=this.accidental();return t[this.coord[1]+MUSIC.baseOffset[1]-7*i+3]+e[i+2]},Note.fromLatin=function(t){var e,i,n=[],s=0,r=t.split(/(\d+)/);if(r.length>3){for(e=0;e<(r.length-1)/2;e++)i=MUSIC.notes[r[s]],i=[i[0]+parseInt(r[s+1]),i[1]],i[0]-=MUSIC.baseOffset[0],i[1]-=MUSIC.baseOffset[1],n[e]=new Note(i),s+=2;return n}return i=MUSIC.notes[r[0]],i=[i[0]+parseInt(r[1]),i[1]],i[0]-=MUSIC.baseOffset[0],i[1]-=MUSIC.baseOffset[1],new Note(i)},Note.prototype.scale=function(t){var e,i=[],n=MUSIC.scales[t];for(i.push(this.add("unison")),e=0;e<n.length;e++)i[e+1]=this.add(Interval.fromName(n[e]));return i.push(this.add("octave")),i},Note.prototype.add=function(t){var e,i=[];if("string"==typeof t&&(t=Interval.fromName(t)),t.length){for(e=0;e<t.length;e++)i[e]=this.add(t[e]);return add_addsubtract_func(i),i}return new Note([this.coord[0]+t.coord[0],this.coord[1]+t.coord[1]])},Note.prototype.subtract=function(t){var e,i,n=[];if("string"==typeof t&&(t=Interval.fromName(t)),t.length){for(e=0;e<t.length;e++)n[e]=this.subtract(t[e]);return add_addsubtract_func(n),n}return i=[this.coord[0]-t.coord[0],this.coord[1]-t.coord[1]],"function"==typeof t.frequency?new Interval(i):new Note(i)},Interval.fromName=function(t){return new Interval(MUSIC.intervals[t])},Interval.fromSemitones=function(t){return new Interval(MUSIC.intervals_semitones[t])},Interval.fromTonesSemitones=function(t){return new Interval([-1*t[0]+3*t[1],2*t[0]+-5*t[1]])},Interval.prototype.tone_semitone=function(){return[5*this.coord[0]+3*this.coord[1],2*this.coord[0]+1*this.coord[1]]},Interval.prototype.semitone=function(){var t=this.tone_semitone();return 2*t[0]+t[1]},Interval.prototype.add=function(t){return"string"==typeof t&&(t=Interval.fromName(t)),new Interval([this.coord[0]+t.coord[0],this.coord[1]+t.coord[1]])},Interval.prototype.subtract=function(t){return"string"==typeof t&&(t=Interval.fromName(t)),new Note([this.coord[0]-t.coord[0],this.coord[1]-t.coord[1]])},function(){function t(t){for(var e,i=0,n=a.length-1;n>=i;)if(e=Math.floor((i+n)/2),a[e]<t)i=e+1;else{if(!(a[e]>t))return a[e];n=e-1}return Math.abs(a[n]-t)>Math.abs(a[i]-t)?a[i]:a[e]}function e(e){var i=0;if("BR"===e||"A"===e)return i;for(var n=0;n<e.length;n++)i+=e[n].charCodeAt();return i=t(i),h.push(i),i}function i(){var t=Math.round(16777215*Math.random());return("#0"+t.toString(16)).replace(/^#0([0-9a-f]{6})$/i,"#$1")}function n(t){var s={};s.name=t.tagName,s.nameValue=e(s.name),s.content=t.innerHTML,s.addBorder=function(){t.style.backgroundColor=i(),t.style.border="1px solid"+i()},s.removeBorder=function(){t.style.backgroundColor="",t.style.border=""},s.children=[];for(var a=0;a<t.childNodes.length;a++){var h=t.childNodes[a];1===h.nodeType&&(s.children.push(n(h)),o++)}return r.push(s),s}function s(){for(var t=document.title,e="C",i="major",n=0;n<t.length;n++){var s=u.indexOf(t[n].toUpperCase());if(-1!=s){e=u.charAt(s);break}}-1!==document.documentURI.indexOf("https")&&(i="harmonic minor"),-1===document.documentURI.indexOf(".com")&&(i="natural minor"),-1!==document.documentURI.indexOf(".org")&&(i="minor pentatonic"),-1!==document.documentURI.indexOf(".co.")&&(i="major pentatonic");for(var r=1;8>=r;r++)for(var o=Note.fromLatin(e+r),h=o.scale(i),l=0;l<h.length;l++)a.push(h[l].frequency());console.log(a)}var r=[],o=0,a=[],h=[],u="ABCDEFG";s(),console.log(n(document.body));var l=0,f=function(t,e){var i=e.nameValue,n=e.children.length||1;AudioletGroup.apply(this,[t,0,1]),this.sine=0===e.children.length?new Sine(this.audiolet,i):new Saw(this.audiolet,i),this.gain=new Gain(this.audiolet),this.modulator=new Triangle(this.audiolet,i/2),this.modulatorMulAdd=new MulAdd(this.audiolet,i*n,i);var s=l/(8-e.children.length%8);this.envelope=new PercussiveEnvelope(this.audiolet,1,.1,s,function(){e.removeBorder(),this.audiolet.scheduler.addRelative(0,this.remove.bind(this))}.bind(this)),this.envMulAdd=new MulAdd(this.audiolet,.5,0),this.filter=new LowPassFilter(this.audiolet,r.length),this.reverb=new Reverb(this.audiolet,.33,.5,.5),this.upMixer=new UpMixer(t,2),this.modulator.connect(this.modulatorMulAdd),this.modulatorMulAdd.connect(this.sine),this.envelope.connect(this.envMulAdd),this.envMulAdd.connect(this.gain,0,1),this.sine.connect(this.reverb),this.reverb.connect(this.gain),this.gain.connect(this.upMixer),this.upMixer.connect(this.outputs[0])},c=function(t){AudioletGroup.call(this,t,0,1),this.sine=new Sine(t,80),this.pitchEnv=new PercussiveEnvelope(t,1,.001,.3),this.pitchEnvMulAdd=new MulAdd(t,80,1),this.gainEnv=new PercussiveEnvelope(t,1,.001,.3,function(){this.audiolet.scheduler.addRelative(0,this.remove.bind(this))}.bind(this)),this.gainEnvMulAdd=new MulAdd(t,.7),this.gain=new Gain(t),this.upMixer=new UpMixer(t,2),this.sine.connect(this.gain),this.pitchEnv.connect(this.pitchEnvMulAdd),this.pitchEnvMulAdd.connect(this.sine),this.gainEnv.connect(this.gainEnvMulAdd),this.gainEnvMulAdd.connect(this.gain,0,1),this.gain.connect(this.upMixer),this.upMixer.connect(this.outputs[0])};extend(c,AudioletGroup);var p=function(t){AudioletGroup.call(this,t,0,1),this.sine=new WhiteNoise(this.audiolet),this.gainEnv=new PercussiveEnvelope(t,1,.01,.05,function(){this.audiolet.scheduler.addRelative(0,this.remove.bind(this))}.bind(this)),this.gainEnvMulAdd=new MulAdd(t,.7),this.gain=new Gain(t),this.filter=new BandPassFilter(t,3e3),this.upMixer=new UpMixer(t,2),this.sine.connect(this.filter),this.filter.connect(this.gain),this.gainEnv.connect(this.gainEnvMulAdd),this.gainEnvMulAdd.connect(this.gain,0,1),this.gain.connect(this.upMixer),this.upMixer.connect(this.outputs[0])};extend(p,AudioletGroup),extend(f,AudioletGroup);var d=function(){this.audiolet=new Audiolet;var t=this,e=this.audiolet.scheduler,i=this.audiolet;l=r.length/3e3,l=1.5-1.5*l,l>2&&(l=2),.75>l&&(l=.75),console.log(r.length);var n,s,o,a=Math.floor(r.length/3);n=new PSequence(r.slice(0,a)),s=new PSequence(r.slice(a+1,2*a)),o=new PSequence(r.slice(2*a+1));var h=[new PSequence([l,l,l,l/2,l/2],1/0),new PSequence([l/3,l/3,l/3,3*l,2*l,l],1/0),new PSequence([2*l],1/0),new PSequence([l/2],1/0),new PSequence([l/2,l/2,l,l/2,l/2,l],1/0),new PSequence([l],1/0),new PSequence([l,l,l,l/2],1/0),new PSequence([l/3],1/0),new PSequence([3*l,l/3,l/3,l/3],1/0),new PSequence([l],1/0)],u=h[document.title.length%10],d=h[document.documentURI.length%10];e.play([n],l,function(t){t.addBorder();var e=new f(i,t);e.connect(i.output)}.bind(t)),e.play([s],l/2,function(t){t.addBorder();var e=new f(i,t);e.connect(i.output)}.bind(t)),e.play([o],2*l,function(t){t.addBorder();var e=new f(i,t);e.connect(i.output)}.bind(t)),e.play([],u,function(){var t=new c(i);t.connect(i.output)}.bind(t)),e.play([],d,function(){var t=new p(i);t.connect(i.output)}.bind(t))};window.audioletApp=new d}();